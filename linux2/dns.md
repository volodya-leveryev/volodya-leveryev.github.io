# DNS

## Теория

DNS - Domain Name System

DNS-имя - латинские буквы в нижнем регистре, цифры, дефисы (нельзя исп. в начале или конце дом. имени)
Точки используются как разделители.

www.s-vfu.ru. - FQDN Fully Qualified Domain Name.

TLD (top level domain) - домены первого уровня:
- национальные
- смысловые (com, edu, gov, mil ...)
- платные (yandex, google)

Punycode - метод преобразования Unicode-строки в DNS-имя.

У каждого компьютера есть свое доменное имя и свой домен.

Серверы DNS обеспечивают работу системы DNS.

Зона ответственности (Authority zone) сервера DNS - часть дерева доменных данный за которую отвечает один или несколько серверов DNS.

Виды DNS-серверов:
- основные сервера
- дополнительные (вспомогательные) сервера

Метод работы DNS-сервера:
- рекурсивные - все дополнительные запросы делает сервер
- нерекурсивные - дополнительные запросы делает клиент

comp1.sales.contoso.com.

Наиболее популярные типы ресурсных записей в DNS:
- A - IPv4-адрес соответствующее доменному имени
- AAAA - IPv6-адрес соответствующее доменному имени
- PTR - доменное имя соответствующее IPv4-адресу (только в домене in-addr.arpa.)
- CNAME - псевдоним для другого доменного имени
- TXT - текстовый комментарий
- MX - сервер передающий почту в данном домене
- NS - DNS-сервер отвечающий за данный домен
- SRV - сервер в данном домене

Для всех записей DNS указывается время жизни в кеше (TTL). Типичное время жизни записей ~ от 5 минут до 1 часа.

Корневые DNS-серверы — 13 серверов (на самом деле гораздо больше) которые отвечают за корневую зону DNS:
- a.root-servers.net.
- b.root-servers.net.
- ...
- m.root-servers.net.

nslookup, dig — утилиты для диагностики DNS.

Регистратор доменных имен — организация, которая выдает доменные имена от имени ICANN

Аренда доменного имени — платная услуга. Типичная стоимость аренды доменного имени второго уровня: 10-35 USD.

Арендатор доменного имени может:
- задать запись на серверах регистратора в вышестоящей зоне
- задать дочерние записи на серверах регистратора в вышестоящей зоне
- задать делегирование на свои сервера в вышестоящей зоне

Прямой резолвинг — получение IP-адреса по доменному имени.

Обратный резолвинг — получение доменного имени по IP-адресу.

`in-addr.arpa.` — технический домен для обратного резолвинга.

BIND — самый популярный DNS-сервер. Текущая версия: BIND 9. Альтернатива: `dnsmasq`.

`named.conf` — основной конфигурационный файл BIND.

DNSSEQ — 

DNS over HTTPS — 

DNS over TLS — 

## Практика

Установить BIND 9:
```
sudo apt-get update
sudo apt-get install bind9
```

Добавить сервера для рекурсивных DNS-запросов, отключить DNSSEQ:

```
cd /etc/bind
sudo nano named.conf.options
```
```
forwarders {
    8.8.8.8;
    8.8.4.4;
};
dnssec-validation no;
```

добавить ссылку на описание доменной зоны:
```
sudo nano named.conf.zones
```
```
zone "example.com" {
    type master;
    file "/etc/bind/db.example.com";
};
```

Добавить ресурсные записи DNS:
```
sudo cp db.localhost db.example.com
sudo nano db.example.com
```
```
$TTL    86400           ; default records TTL
$ORIGIN example.com.    ; now @ denotes example.com.
@       IN      SOA     ns.example.com. root.localhost. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                          86400 )       ; TTL of SOA
;
@       IN      NS      ns
ns      IN      A       192.168.1.1
www     IN      A       192.168.1.1
```

Проверка:
```
systemctl status named.service
sudo systemctl restart named.service
sudo journalctl -xeu named.service
nslookup www.google.com 127.0.0.1
```
